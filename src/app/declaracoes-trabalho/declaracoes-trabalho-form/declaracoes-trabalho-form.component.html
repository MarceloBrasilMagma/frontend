<nz-card *ngIf="!!paramProjetoId" nzSize="small" class="mb-2">
  <nz-page-header
    (nzBack)="router.navigate(['/pre-projetos', 'editar', paramProjetoId])"
    nzBackIcon
    [nzSubtitle]="projeto?.nome"
    style="padding: 0 0 0 5px"
  >
  </nz-page-header>
</nz-card>

<nz-card
  *ngIf="!!declaracaoTrabalhoId"
  [nzTitle]="'Editar Declaração de Trabalho'"
>
  <div *ngIf="!!declaracaoTrabalhoId" style="padding: 10px 0px 10px 0px">
    <div nz-row>
      <div nz-col>
        <p class="text-dark font-weight-bold">
          Número: {{ declaracaoTrabalho.id }}
          <nz-tag style="margin-left: 10px" [nzColor]="corSituacao">{{
            declaracaoTrabalho?.situacaoDescricao
          }}</nz-tag>
        </p>
      </div>
      <div nz-col nzFlex="1" class="d-none d-lg-block">
        <nz-space class="d-flex justify-content-end">
          <ng-container *ngIf="podeEditarPermissoes">
            <button
              *nzSpaceItem
              nz-button
              (click)="exibirModalPermissoes()"
              nzType="link"
            >
              <i nz-icon nzType="lock" nzTheme="outline"></i>
              <span style="color: black"> Permissões</span>
            </button>
          </ng-container>
          <ng-container *ngIf="possuiPermissaoEditar(['Administrador'])">
            <button
              *nzSpaceItem
              nz-button
              (click)="excluirDt()"
              nzType="default"
              [nzLoading]="salvandoDeclaracoesTrabalho"
              nzDanger
            >
              <i nz-icon nzType="close" nzTheme="outline"></i>
              Excluir DT
            </button>
          </ng-container>
          <ng-container *ngIf="exibirSalvar && !!declaracaoTrabalhoId">
            <button
              *nzSpaceItem
              nz-button
              (click)="salvar()"
              nzType="default"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="save" nzTheme="outline"></i>
              {{ textoBotaoSalvar }}
            </button>
          </ng-container>
          <ng-container *ngIf="exibirAguardandoAjustes">
            <button
              *nzSpaceItem
              nz-button
              (click)="
                salvarAlterarSituacao(
                  DeclaracaoTrabalhoSituacao.AguardandoAjustes
                )
              "
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="rollback" nzTheme="outline"></i>
              Solicitar novas informações
            </button>
          </ng-container>
          <ng-container *ngIf="exibirEnviarParaFornecedor">
            <button
              *nzSpaceItem
              nz-button
              (click)="
                salvarAlterarSituacao(
                  DeclaracaoTrabalhoSituacao.AguardandoFornecedor
                )
              "
              nzType="primary"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="shopping" nzTheme="outline"></i>
              Enviar para Fornecedor
            </button>
          </ng-container>
          <ng-container *ngIf="exibirResponderFornecedor">
            <button
              *nzSpaceItem
              nz-button
              (click)="
                salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Respondida)
              "
              nzType="primary"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="dollar" nzTheme="outline"></i>
              Responder ao Solicitante
            </button>
          </ng-container>
          <ng-container *ngIf="exibirRetornarParaFornecedor">
            <button
              *nzSpaceItem
              nz-button
              (click)="
                salvarAlterarSituacao(
                  DeclaracaoTrabalhoSituacao.AguardandoFornecedor
                )
              "
              nzType="default"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="rollback" nzTheme="outline"></i>
              Solicitar Ajustes ao Fornecedor
            </button>
          </ng-container>
          <ng-container *ngIf="exibirEnviarParaClassificacao">
            <button
              *nzSpaceItem
              nz-button
              (click)="
                salvarAlterarSituacao(
                  DeclaracaoTrabalhoSituacao.AguardandoClassificacao
                )
              "
              nzType="primary"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="dollar" nzTheme="outline"></i>
              Enviar para Classificação Contábil
            </button>
          </ng-container>
          <ng-container *ngIf="exibirRealizarClassificacaoContabil">
            <button
              *nzSpaceItem
              nz-button
              nz-popconfirm
              nzPopconfirmTitle="Tem certeza que deseja concluir a classificação contábil?"
              nzOkText="Sim"
              (nzOnConfirm)="
                salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Finalizada)
              "
              nzType="primary"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="dollar" nzTheme="outline"></i>
              Concluir Classificação Contábil
            </button>
          </ng-container>
          <ng-container *ngIf="exibirCancelar">
            <button
              *nzSpaceItem
              nz-button
              nz-popconfirm
              nzPopconfirmTitle="Tem certeza que deseja cancelar a DT?"
              nzOkText="Sim"
              (nzOnConfirm)="
                salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Cancelada)
              "
              nzDanger
            >
              <i nz-icon nzType="close" nzTheme="outline"></i>
              Cancelar DT
            </button>
          </ng-container>
        </nz-space>
      </div>
      <div nz-col nzFlex="1" class="d-block d-lg-none text-right">
        <nz-space>
          <div *nzSpaceItem>
            <button nz-button nz-dropdown [nzDropdownMenu]="menu4">
              Ações
              <i nz-icon nzType="down"></i>
            </button>
            <nz-dropdown-menu #menu4="nzDropdownMenu">
              <ul nz-menu>
                <li
                  nz-menu-item
                  *ngIf="possuiPermissaoEditar(['Administrador'])"
                  nz-button
                  (click)="excluirDt()"
                  nzType="default"
                  [nzLoading]="salvandoDeclaracoesTrabalho"
                  nzDanger
                >
                  <i nz-icon nzType="close" nzTheme="outline"></i>
                  Excluir DT
                </li>
                <li
                  nz-menu-item
                  *ngIf="exibirSalvar"
                  nz-button
                  (click)="salvar()"
                  nzType="default"
                  [nzLoading]="salvandoDeclaracoesTrabalho"
                >
                  <i nz-icon nzType="save" nzTheme="outline"></i>
                  {{ textoBotaoSalvar }}
                </li>
                <li
                  nz-menu-item
                  *ngIf="exibirEmElaboracao"
                  nz-button
                  (click)="
                    salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Elaboracao)
                  "
                  [nzLoading]="salvandoDeclaracoesTrabalho"
                >
                  <i nz-icon nzType="rollback" nzTheme="outline"></i>
                  Solicitar novas informações
                </li>
                <li
                  nz-menu-item
                  *ngIf="exibirEnviarParaFornecedor"
                  nz-button
                  (click)="
                    salvarAlterarSituacao(
                      DeclaracaoTrabalhoSituacao.AguardandoFornecedor
                    )
                  "
                  nzType="primary"
                  [nzLoading]="salvandoDeclaracoesTrabalho"
                >
                  <i nz-icon nzType="shopping" nzTheme="outline"></i>
                  Enviar para Fornecedor
                </li>
                <li
                  nz-menu-item
                  *ngIf="exibirResponderFornecedor"
                  nz-button
                  (click)="
                    salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Respondida)
                  "
                  nzType="primary"
                  [nzLoading]="salvandoDeclaracoesTrabalho"
                >
                  <i nz-icon nzType="dollar" nzTheme="outline"></i>
                  Responder ao Solicitante
                </li>
                <li
                  nz-menu-item
                  *ngIf="exibirRetornarParaFornecedor"
                  nz-button
                  (click)="
                    salvarAlterarSituacao(
                      DeclaracaoTrabalhoSituacao.AguardandoFornecedor
                    )
                  "
                  nzType="default"
                  [nzLoading]="salvandoDeclaracoesTrabalho"
                >
                  <i nz-icon nzType="rollback" nzTheme="outline"></i>
                  Solicitar Ajustes ao Fornecedor
                </li>
                <li
                  nz-menu-item
                  *ngIf="exibirEnviarParaClassificacao"
                  nz-button
                  (click)="
                    salvarAlterarSituacao(
                      DeclaracaoTrabalhoSituacao.AguardandoClassificacao
                    )
                  "
                  nzType="primary"
                  [nzLoading]="salvandoDeclaracoesTrabalho"
                >
                  <i nz-icon nzType="dollar" nzTheme="outline"></i>
                  Enviar para Classificação Contábil
                </li>
                <li
                  nz-menu-item
                  *ngIf="exibirRealizarClassificacaoContabil"
                  nz-button
                  nz-popconfirm
                  nzPopconfirmTitle="Tem certeza que deseja concluir a classificação contábil?"
                  nzOkText="Sim"
                  (nzOnConfirm)="
                    salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Finalizada)
                  "
                  nzType="primary"
                  [nzLoading]="salvandoDeclaracoesTrabalho"
                >
                  <i nz-icon nzType="dollar" nzTheme="outline"></i>
                  Concluir Classificação Contábil
                </li>
              </ul>
            </nz-dropdown-menu>
          </div>
        </nz-space>
      </div>
    </div>

    <div nz-row nzGutter="24" *ngIf="exibirMotivoPedidoAjustes">
      <nz-divider></nz-divider>
      <div nz-col nzSpan="24">
        <nz-collapse [nzBordered]="false" class="mt-2">
          <nz-collapse-panel [nzActive]="true" nzHeader="Mensagens">
            <div *ngIf="mensagens.length === 1">
              <div *ngFor="let situacao of mensagens">
                <nz-card
                  nzSize="small"
                  [nzTitle]="
                    situacao.situacaoAnteriorDescricao +
                    ' 🠮 ' +
                    situacao.situacaoDescricao
                  "
                  class="mt-3"
                  style="width: 100%; text-align: justify"
                >
                  <p>
                    <span style="font-weight: bolder">Data: </span
                    >{{ situacao.data.toLocaleString() }}
                  </p>
                  <p>
                    <span style="font-weight: bolder">Mensagem:</span>
                    {{ situacao.mensagem }}
                  </p>
                </nz-card>
              </div>
            </div>
            <div *ngIf="mensagens.length > 1">
              <nz-card
                nzSize="small"
                [nzTitle]="
                  mensagens[0].situacaoAnteriorDescricao +
                  ' 🠮 ' +
                  mensagens[0].situacaoDescricao
                "
                class="mt-3"
                style="width: 100%; text-align: justify"
              >
                <p>
                  <span style="font-weight: bolder">Data: </span
                  >{{ mensagens[0].data.toLocaleString() }}
                </p>
                <p>
                  <span style="font-weight: bolder">Mensagem:</span>
                  {{ mensagens[0].mensagem }}
                </p>
              </nz-card>
              <div *ngFor="let situacao of mensagens.slice(1)">
                <nz-card
                  *ngIf="exibirMsg"
                  nzSize="small"
                  [nzTitle]="
                    situacao.situacaoAnteriorDescricao +
                    ' 🠮 ' +
                    situacao.situacaoDescricao
                  "
                  class="mt-3"
                  style="width: 100%; text-align: justify"
                >
                  <p>
                    <span style="font-weight: bolder">Data: </span
                    >{{ situacao.data.toLocaleString() }}
                  </p>
                  <p>
                    <span style="font-weight: bolder">Mensagem:</span>
                    {{ situacao.mensagem }}
                  </p>
                </nz-card>
              </div>
              <button
                (click)="toogleMsgns()"
                nz-button
                nz-button
                nzType="primary"
                nzSize="small"
              >
                {{ btnTexto ? "Ver Mais" : "Ver Menos" }}
              </button>
            </div>
          </nz-collapse-panel>
        </nz-collapse>
      </div>
    </div>
  </div>
</nz-card>
<nz-card
  *ngIf="!!declaracaoTrabalhoId"
  style="padding-top: 15px; margin-top: 15px"
>
  <nz-steps
    nzProgressDot
    [nzCurrent]="timeLineIndex"
    nzDirection="horizontal"
    nzSize="small"
  >
    <nz-step
      nzTitle="Em elaboração"
      [nzDescription]="dataEmElaboracao"
    ></nz-step>
    <nz-step
      nzTitle="Aguardando Fornecedor"
      [nzDescription]="dataAguardandoFornecedor"
    ></nz-step>
    <nz-step
      nzTitle="Declaração Respondida"
      [nzDescription]="dataDtRespondida"
    ></nz-step>
    <nz-step
      nzTitle="Aguardando Classificação Contábil"
      [nzDescription]="dataAguardandoClassificacao"
    ></nz-step>
    <!--  <nz-step
            [nzStatus]="dtReprovada ? 'error': dtAprovada ? 'finish': 'wait'"
            [nzTitle]="dtReprovada ? 'Cancelada' : 'Finalizada'"
            [nzDescription]="dtReprovada ? dataCancelada: dataFinalizada"
          </nz-step>
      > -->
  </nz-steps>
</nz-card>
<nz-card
  id="form-card"
  [nzTitle]="!declaracaoTrabalhoId ? 'Cadastrar Declaração de Trabalho' : ''"
  [nzActions]="[acoes]"
>
  <nz-tabset
    nzType="card"
    [nzSelectedIndex]="tabIndex"
    (nzSelectedIndexChange)="selectedIndexChange($event)"
  >
    <nz-tab nzTitle="Dados">
      <nz-affix nzTarget="form-card" class="affix-toggle-expandir">
        <div class="toggle-expandir-wrapper">
          <p class="mb-2">
            <button
              *ngIf="!anyExpanded"
              nz-button
              (click)="expandAll()"
              nzSize="small"
              class="mr-2"
            >
              <i nz-icon nzType="down"></i
              ><span class="d-none d-sm-inline">Expandir tudo</span>
            </button>
            <button
              *ngIf="anyExpanded"
              nz-button
              (click)="collapseAll()"
              nzSize="small"
            >
              <i nz-icon nzType="up"></i
              ><span class="d-none d-sm-inline">Recolher tudo</span>
            </button>
          </p>
        </div>
      </nz-affix>

      <nz-collapse [nzBordered]="false" class="mt-2">
        <nz-collapse-panel
          nzHeader="1. Dados da Declaração de Trabalho"
          [nzActive]="true"
        >
          <nz-card nzSize="small">
            <form nz-form [formGroup]="form" nzLayout="vertical">
              <div nz-row nzGutter="24">
                <div
                  *ngIf="
                    declaracaoTrabalhoId ||
                    paramProjetoId ||
                    paramProjetoPlurianualId
                  "
                  nz-col
                  nzXs="24"
                  nzSm="12"
                >
                  <nz-form-item>
                    <nz-form-label> Projeto </nz-form-label>
                    <nz-form-control>
                      <input
                        nz-input
                        [value]="
                          projeto?.nome ||
                          projetoPlurianual?.nome ||
                          declaracaoTrabalho?.projetoNome ||
                          declaracaoTrabalho?.projetoPlurianualNome ||
                          declaracaoTrabalho?.preProjetoNome
                        "
                        disabled
                      />
                    </nz-form-control>
                  </nz-form-item>
                </div>

                <div
                  *ngIf="
                    !declaracaoTrabalhoId &&
                    !paramProjetoId &&
                    !paramProjetoPlurianualId
                  "
                  nz-col
                  nzXs="24"
                  nzSm="12"
                >
                  <nz-form-item>
                    <nz-form-label> Projeto </nz-form-label>
                    <nz-form-control>
                      <nz-select
                        formControlName="projetoId"
                        nzPlaceHolder="Projeto"
                        nzAllowClear
                        nzShowSearch
                        nzServerSearch
                        (nzOnSearch)="searchProjeto($event)"
                        [nzDisabled]="!possuiPermissaoEditarDados"
                        (ngModelChange)="atualizaTipoProjeto($event)"
                      >
                        <ng-container *ngFor="let i of projetos">
                          <nz-option
                            *ngIf="!buscandoProjeto"
                            [nzValue]="i.id"
                            [nzLabel]="i.nome"
                            nzCustomContent
                          >
                            {{ i.tipoDescricao }}: {{ i.nome }}
                          </nz-option>
                        </ng-container>
                        <nz-option
                          *ngIf="buscandoProjeto"
                          nzDisabled
                          nzCustomContent
                        >
                          <i
                            nz-icon
                            nzType="loading"
                            class="loading-icon mr-2"
                          ></i>
                          Buscando ...
                        </nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="12">
                  <nz-form-item>
                    <nz-form-label nzRequired>Fornecedor Interno</nz-form-label>
                    <nz-form-control>
                      <nz-select
                        formControlName="departamentoId"
                        nzPlaceHolder="Fornecedor Interno"
                        nzShowSearch
                        nzAllowClear
                        (ngModelChange)="selecionouDepartamento($event)"
                        [nzDisabled]="!possuiPermissaoEditarDados"
                      >
                        <nz-option
                          *ngFor="let d of departamentos"
                          [nzLabel]="d.nome"
                          [nzValue]="d.id"
                        >
                        </nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </div>

                <div nz-col nzXs="24" [nzSm]="exibirCamposFornecedor ? 12 : 24">
                  <nz-form-item>
                    <nz-form-label nzRequired> Responsável </nz-form-label>
                    <nz-form-control>
                      <nz-select
                        formControlName="responsavel"
                        nzPlaceHolder="Responsável"
                        [nzDisabled]="!possuiPermissaoEditarDados"
                        nzAllowClear
                        nzShowSearch
                        nzServerSearch
                        (nzOnSearch)="searchResponsavel($event)"
                      >
                        <ng-container *ngFor="let g of responsaveisAd">
                          <nz-option
                            *ngIf="!buscandoResponsavelAd"
                            [nzValue]="g"
                            [nzLabel]="g.nome"
                          >
                          </nz-option>
                        </ng-container>
                        <nz-option
                          *ngIf="buscandoResponsavelAd"
                          nzDisabled
                          nzCustomContent
                        >
                          <i
                            nz-icon
                            nzType="loading"
                            class="loading-icon mr-2"
                          ></i>
                          Buscando ...
                        </nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </div>

                <div
                  nz-col
                  nzXs="24"
                  nzSm="12"
                  *ngIf="exibirCamposFornecedor && !exibirCamposClassificacao"
                >
                  <nz-form-item class="mb-0">
                    <nz-form-label>
                      Prazo de Resposta do Fornecedor
                    </nz-form-label>
                    <nz-form-control>
                      <input
                        type="date"
                        [readonly]="!possuiPermissaoEditar(['Administrador'])"
                        nz-input
                        formControlName="dataEntregaFornecedor"
                        max="2999-12-31"
                      />
                    </nz-form-control>
                  </nz-form-item>
                </div>

                <div
                  nz-col
                  nzXs="24"
                  nzSm="12"
                  *ngIf="exibirCamposClassificacao"
                >
                  <nz-form-item class="mb-0">
                    <nz-form-label>
                      Prazo para Classificação Contábil
                    </nz-form-label>
                    <nz-form-control>
                      <input
                        type="date"
                        [readonly]="!possuiPermissaoEditar(['Administrador'])"
                        nz-input
                        formControlName="dataEntregaClassificacaoContabil"
                        max="2999-12-31"
                      />
                    </nz-form-control>
                  </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="24">
                  <nz-form-item>
                    <nz-form-label> Corresponsáveis </nz-form-label>
                    <nz-form-control>
                      <nz-select
                        formControlName="corresponsaveis"
                        nzPlaceHolder="Corresponsáveis"
                        nzMode="multiple"
                        [nzDisabled]="!possuiPermissaoEditarDados"
                        nzSize="large"
                        nzShowSearch
                        nzServerSearch
                        (nzOnSearch)="searchCorresponsavel($event)"
                      >
                        <ng-container *ngFor="let g of corresponsaveisAd">
                          <nz-option
                            *ngIf="!buscandoCorresponsavelAd"
                            [nzValue]="g"
                            [nzLabel]="g.nome"
                          >
                          </nz-option>
                        </ng-container>
                        <nz-option
                          *ngIf="buscandoCorresponsavelAd"
                          nzDisabled
                          nzCustomContent
                        >
                          <i
                            nz-icon
                            nzType="loading"
                            class="loading-icon mr-2"
                          ></i>
                          Buscando ...
                        </nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>
            </form>
          </nz-card>
        </nz-collapse-panel>

        <nz-collapse-panel
          nzHeader="2. Especificação da Demanda"
          [nzActive]="true"
        >
          <p class="text-red-500">* Preenchimento Obrigatório</p>
          <nz-card nzSize="small">
            <form nz-form [formGroup]="form" nzLayout="vertical">
              <div nz-row nzGutter="24">
                <div nz-col nzSpan="24">
                  <nz-form-item class="mb-0">
                    <nz-form-control>
                      <textarea
                        nz-input
                        formControlName="solucaoProposta"
                        placeholder="Especificação da Demanda"
                        [nzAutosize]="{ minRows: 3, maxRows: 6 }"
                        [readonly]="!possuiPermissaoEditarDados"
                      >
                      </textarea>
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>
            </form>
          </nz-card>
        </nz-collapse-panel>

        <nz-collapse-panel
          nzHeader="3. Para o desenvolvimento do projeto, você (gerente do projeto), espera que a solução seja executada para qual data?"
          [nzActive]="true"
        >
          <p class="text-red-500">* Preenchimento Obrigatório</p>
          <nz-card nzSize="small">
            <form nz-form [formGroup]="form" nzLayout="vertical">
              <div nz-row nzGutter="6">
                <div nz-col nzSpan="6">
                  <nz-form-item class="mb-0">
                    <nz-form-control>
                      <input
                        type="month"
                        nz-input
                        formControlName="prazoEsperadoExecucaoSolucao"
                        max="2999-12-31"
                        [readonly]="!possuiPermissaoEditarDados"
                      />
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>
            </form>
          </nz-card>
        </nz-collapse-panel>

        <ng-container *ngIf="exibirCamposFornecedor">
          <nz-collapse-panel
            nzHeader="4. Viável Tecnicamente?"
            [nzActive]="true"
          >
            <p class="text-red-500">* Preenchimento Obrigatório</p>
            <nz-card nzSize="small">
              <form nz-form [formGroup]="formFornecedor" nzLayout="vertical">
                <div nz-row nzGutter="24">
                  <div nz-col nzSpan="24">
                    <nz-form-item class="mb-0">
                      <nz-form-control>
                        <nz-radio-group
                          formControlName="viavelTecnicamente"
                          [nzDisabled]="
                            !usuarioResponsavelDt &&
                            !possuiPermissaoEditar(['Administrador'])
                          "
                        >
                          <label
                            nzName="viavelTecnicamente"
                            nz-radio-button
                            [nzValue]="true"
                            >Sim</label
                          >
                          <label
                            nzName="viavelTecnicamente"
                            nz-radio-button
                            [nzValue]="false"
                            >Não</label
                          >
                        </nz-radio-group>
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                </div>
              </form>
            </nz-card>
          </nz-collapse-panel>

          <nz-collapse-panel nzHeader="5. Parecer Técnico" [nzActive]="true">
            <p class="text-red-500">* Preenchimento Obrigatório</p>
            <nz-card nzSize="small">
              <form nz-form [formGroup]="formFornecedor" nzLayout="vertical">
                <div nz-row nzGutter="24">
                  <div nz-col nzSpan="24">
                    <nz-form-item class="mb-0">
                      <nz-form-control>
                        <textarea
                          nz-input
                          formControlName="parecerTecnico"
                          placeholder="Parecer Técnico"
                          [nzAutosize]="{ minRows: 3, maxRows: 6 }"
                          [readonly]="
                            !usuarioResponsavelDt &&
                            !possuiPermissaoEditar(['Administrador'])
                          "
                        >
                        </textarea>
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                </div>
              </form>
            </nz-card>
          </nz-collapse-panel>

          <nz-collapse-panel
            nzHeader="6. Período de Execução (em dias, meses ou anos)"
            [nzActive]="true"
          >
            <p class="text-red-500">* Preenchimento Obrigatório</p>
            <nz-card nzSize="small">
              <form nz-form [formGroup]="formFornecedor" nzLayout="vertical">
                <div nz-row nzGutter="24">
                  <div nz-col nzSpan="24">
                    <nz-form-item class="mb-0">
                      <nz-form-control>
                        <input
                          nz-input
                          formControlName="periodoExecucaoSolucao"
                          [readonly]="
                            !usuarioResponsavelDt &&
                            !possuiPermissaoEditar(['Administrador'])
                          "
                          placeholder="Período de Execução (em dias, meses ou anos)"
                        />
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                </div>
              </form>
            </nz-card>
          </nz-collapse-panel>

          <nz-collapse-panel nzHeader="7. Considerações" [nzActive]="true">
            <p class="text-red-500">* Preenchimento Obrigatório</p>
            <nz-card nzSize="small">
              <form nz-form [formGroup]="formFornecedor" nzLayout="vertical">
                <div nz-row nzGutter="24">
                  <div nz-col nzSpan="24">
                    <nz-form-item class="mb-0">
                      <nz-form-control>
                        <textarea
                          nz-input
                          formControlName="consideracoes"
                          placeholder="Considerações"
                          [nzAutosize]="{ minRows: 3, maxRows: 6 }"
                          [readonly]="
                            !usuarioResponsavelDt &&
                            !possuiPermissaoEditar(['Administrador'])
                          "
                        >
                        </textarea>
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                </div>
              </form>
            </nz-card>
          </nz-collapse-panel>
        </ng-container>
      </nz-collapse>

      <!-- <button *ngIf="!declaracaoTrabalhoId" nz-button nzType="primary" nzShape="circle"
        (click)="exibirModalConfirmacao()" [nzLoading]="salvandoDeclaracoesTrabalho" class="salvar-floating-button">
        <i nz-icon nzType="save" nzTheme="outline"></i>
      </button> -->
    </nz-tab>

    <nz-tab *ngIf="!declaracaoTrabalhoId" nzTitle="Anexos">
      <app-declaracao-trabalho-cadastrar-anexar
        [(anexos)]="anexosCadastro"
      ></app-declaracao-trabalho-cadastrar-anexar>
    </nz-tab>

    <nz-tab *ngIf="exibirCamposFornecedor" nzTitle="Orçamento">
      <nz-spin nzTip="Aguarde..." [nzSpinning]="carregandoDeclaracaoTrabalho">
        <app-orcamentos-listar
          [possuiPermissaoEdicao]="possuiPermissaoEditarOrcamento"
          [possuiPermissaoExcluirOrcamento]="possuiPermissaoExcluirOrcamento"
          [declaracaoTrabalho]="declaracaoTrabalho"
        >
        </app-orcamentos-listar>
      </nz-spin>
    </nz-tab>

    <nz-tab *ngIf="declaracaoTrabalhoId" nzTitle="Anexos">
      <nz-spin nzTip="Aguarde..." [nzSpinning]="carregandoDeclaracaoTrabalho">
        <app-declaracao-trabalho-editar-anexar
          [declaracaoTrabalho]="declaracaoTrabalho"
        >
        </app-declaracao-trabalho-editar-anexar>
      </nz-spin>
    </nz-tab>

    <nz-tab
      nzTitle="Histórico de Alterações"
      *ngIf="possuiPermissaoVerHistorico"
    >
      <app-log-alteracao
        *ngIf="!!declaracaoTrabalho"
        [nomeEntidade]="'DeclaracaoTrabalho'"
        [idEntidade]="declaracaoTrabalhoId"
      ></app-log-alteracao>
    </nz-tab>
  </nz-tabset>
</nz-card>
<ng-template #acoes>
  <div nz-col nzFlex="1" class="d-none d-lg-block">
    <nz-space class="d-flex justify-content-end">
      <ng-container *ngIf="!declaracaoTrabalhoId">
        <button
          *nzSpaceItem
          nz-button
          nz-popconfirm
          nzPopconfirmTitle="Tem certeza que deseja salvar?"
          nzOkText="Sim"
          (nzOnConfirm)="salvar(false)"
          nzType="default"
          [nzLoading]="salvandoDeclaracoesTrabalho"
        >
          <i nz-icon nzType="save" nzTheme="outline"></i>
          Salvar
        </button>
      </ng-container>

      <ng-container *ngIf="!declaracaoTrabalhoId">
        <button
          *nzSpaceItem
          nz-button
          nz-popconfirm
          nzPopconfirmTitle="Tem certeza que deseja enviar para o fornecedor?"
          nzOkText="Sim"
          (nzOnConfirm)="salvar(true)"
          nzType="primary"
          [nzLoading]="salvandoDeclaracoesTrabalho"
        >
          <i
            nz-icon
            nzType="save"
            nzTheme="outline"
            style="border-right: none"
          ></i>
          Salvar e Enviar para Fornecedor
        </button>
      </ng-container>

      <ng-container
        *ngIf="
          possuiPermissaoEditar(['Administrador']) && !!declaracaoTrabalhoId
        "
      >
        <button
          *nzSpaceItem
          nz-button
          (click)="excluirDt()"
          nzType="default"
          [nzLoading]="salvandoDeclaracoesTrabalho"
          nzDanger
        >
          <i nz-icon nzType="close" nzTheme="outline"></i>
          Excluir DT
        </button>
      </ng-container>

      <ng-container *ngIf="exibirSalvar && !!declaracaoTrabalhoId">
        <button
          *nzSpaceItem
          nz-button
          (click)="salvar()"
          nzType="default"
          [nzLoading]="salvandoDeclaracoesTrabalho"
        >
          <i nz-icon nzType="save" nzTheme="outline"></i>
          {{ textoBotaoSalvar }}
        </button>
      </ng-container>

      <ng-container *ngIf="exibirAguardandoAjustes">
        <button
          *nzSpaceItem
          nz-button
          (click)="
            salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.AguardandoAjustes)
          "
          [nzLoading]="salvandoDeclaracoesTrabalho"
        >
          <i nz-icon nzType="rollback" nzTheme="outline"></i>
          Solicitar novas informações
        </button>
      </ng-container>

      <ng-container *ngIf="exibirEnviarParaFornecedor">
        <button
          *nzSpaceItem
          nz-button
          (click)="
            salvarAlterarSituacao(
              DeclaracaoTrabalhoSituacao.AguardandoFornecedor
            )
          "
          nzType="primary"
          [nzLoading]="salvandoDeclaracoesTrabalho"
        >
          <i nz-icon nzType="shopping" nzTheme="outline"></i>
          Enviar para Fornecedor
        </button>
      </ng-container>

      <ng-container *ngIf="exibirResponderFornecedor">
        <button
          *nzSpaceItem
          nz-button
          (click)="salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Respondida)"
          nzType="primary"
          [nzLoading]="salvandoDeclaracoesTrabalho"
        >
          <i
            nz-icon
            nzType="dollar"
            nzTheme="outline"
            style="border-right: none"
          ></i>
          Responder ao Solicitante
        </button>
      </ng-container>

      <ng-container *ngIf="exibirRetornarParaFornecedor">
        <button
          *nzSpaceItem
          nz-button
          (click)="
            salvarAlterarSituacao(
              DeclaracaoTrabalhoSituacao.AguardandoFornecedor
            )
          "
          nzType="default"
          [nzLoading]="salvandoDeclaracoesTrabalho"
        >
          <i nz-icon nzType="rollback" nzTheme="outline"></i>
          Solicitar Ajustes ao Fornecedor
        </button>
      </ng-container>

      <ng-container *ngIf="exibirEnviarParaClassificacao">
        <button
          *nzSpaceItem
          nz-button
          (click)="
            salvarAlterarSituacao(
              DeclaracaoTrabalhoSituacao.AguardandoClassificacao
            )
          "
          nzType="primary"
          [nzLoading]="salvandoDeclaracoesTrabalho"
        >
          <i
            nz-icon
            nzType="dollar"
            nzTheme="outline"
            style="border-right: none"
          ></i>
          Enviar para Classificação Contábil
        </button>
      </ng-container>

      <ng-container *ngIf="exibirRealizarClassificacaoContabil">
        <button
          *nzSpaceItem
          nz-button
          nz-popconfirm
          nzPopconfirmTitle="Tem certeza que deseja concluir a classificação contábil?"
          nzOkText="Sim"
          (nzOnConfirm)="
            salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Finalizada)
          "
          nzType="primary"
          [nzLoading]="salvandoDeclaracoesTrabalho"
        >
          <i
            nz-icon
            nzType="dollar"
            nzTheme="outline"
            style="border-right: none"
          ></i>
          Concluir Classificação Contábil
        </button>
      </ng-container>

      <ng-container *ngIf="exibirCancelar">
        <button
          *nzSpaceItem
          nz-button
          nz-popconfirm
          nzPopconfirmTitle="Tem certeza que deseja cancelar a DT?"
          nzOkText="Sim"
          (nzOnConfirm)="
            salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Cancelada)
          "
          nzDanger
        >
          <i nz-icon nzType="close" nzTheme="outline"></i>
          Cancelar DT
        </button>
      </ng-container>
    </nz-space>
  </div>
  <div nz-col nzFlex="1" class="d-block d-lg-none text-right">
    <nz-space>
      <div *nzSpaceItem>
        <button nz-button nz-dropdown [nzDropdownMenu]="menu4">
          Ações
          <i nz-icon nzType="down"></i>
        </button>
        <nz-dropdown-menu #menu4="nzDropdownMenu">
          <ul nz-menu>
            <li
              nz-menu-item
              *ngIf="possuiPermissaoEditar(['Administrador'])"
              nz-button
              (click)="excluirDt()"
              nzType="default"
              [nzLoading]="salvandoDeclaracoesTrabalho"
              nzDanger
            >
              <i nz-icon nzType="close" nzTheme="outline"></i>
              Excluir DT
            </li>
            <li
              nz-menu-item
              *ngIf="exibirSalvar"
              nz-button
              (click)="salvar()"
              nzType="default"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="save" nzTheme="outline"></i>
              {{ textoBotaoSalvar }}
            </li>
            <li
              nz-menu-item
              *ngIf="exibirEmElaboracao"
              nz-button
              (click)="
                salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Elaboracao)
              "
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="rollback" nzTheme="outline"></i>
              Solicitar novas informações
            </li>
            <li
              nz-menu-item
              *ngIf="exibirEnviarParaFornecedor"
              nz-button
              (click)="
                salvarAlterarSituacao(
                  DeclaracaoTrabalhoSituacao.AguardandoFornecedor
                )
              "
              nzType="primary"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="shopping" nzTheme="outline"></i>
              Enviar para Fornecedor
            </li>
            <li
              nz-menu-item
              *ngIf="exibirResponderFornecedor"
              nz-button
              (click)="
                salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Respondida)
              "
              nzType="primary"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="dollar" nzTheme="outline"></i>
              Responder ao Solicitante
            </li>
            <li
              nz-menu-item
              *ngIf="exibirRetornarParaFornecedor"
              nz-button
              (click)="
                salvarAlterarSituacao(
                  DeclaracaoTrabalhoSituacao.AguardandoFornecedor
                )
              "
              nzType="default"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="rollback" nzTheme="outline"></i>
              Solicitar Ajustes ao Fornecedor
            </li>
            <li
              nz-menu-item
              *ngIf="exibirEnviarParaClassificacao"
              nz-button
              (click)="
                salvarAlterarSituacao(
                  DeclaracaoTrabalhoSituacao.AguardandoClassificacao
                )
              "
              nzType="primary"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="dollar" nzTheme="outline"></i>
              Enviar para Classificação Contábil
            </li>
            <li
              nz-menu-item
              *ngIf="exibirRealizarClassificacaoContabil"
              nz-button
              nz-popconfirm
              nzPopconfirmTitle="Tem certeza que deseja concluir a classificação contábil?"
              nzOkText="Sim"
              (nzOnConfirm)="
                salvarAlterarSituacao(DeclaracaoTrabalhoSituacao.Finalizada)
              "
              nzType="primary"
              [nzLoading]="salvandoDeclaracoesTrabalho"
            >
              <i nz-icon nzType="dollar" nzTheme="outline"></i>
              Concluir Classificação Contábil
            </li>
          </ul>
        </nz-dropdown-menu>
      </div>
    </nz-space>
  </div>
</ng-template>
